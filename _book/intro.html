<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Science Looks at Discrimination - 1&nbsp; Introduction and Motivating Examples</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./PartI.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./intro.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and Motivating Examples</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science Looks at Discrimination</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and Motivating Examples</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./PartI.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Part I: Adjustment for Confounders</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./PartII.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Part II: Discovering/Mitigating Bias in Machine Learning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Appendices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Author Bios</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-ucb" id="toc-sec-ucb" class="nav-link active" data-scroll-target="#sec-ucb"><span class="header-section-number">1.1</span> UC Berkeley discrimination claims</a></li>
  <li><a href="#sec-census" id="toc-sec-census" class="nav-link" data-scroll-target="#sec-census"><span class="header-section-number">1.2</span> US Census data</a></li>
  <li><a href="#commonality" id="toc-commonality" class="nav-link" data-scroll-target="#commonality"><span class="header-section-number">1.3</span> Commonality</a></li>
  <li><a href="#compas-recidivism-data" id="toc-compas-recidivism-data" class="nav-link" data-scroll-target="#compas-recidivism-data"><span class="header-section-number">1.4</span> COMPAS recidivism data</a></li>
  <li><a href="#summary-the-two-kinds-of-discrimination-analysis-covered-here" id="toc-summary-the-two-kinds-of-discrimination-analysis-covered-here" class="nav-link" data-scroll-target="#summary-the-two-kinds-of-discrimination-analysis-covered-here"><span class="header-section-number">1.5</span> Summary: the two kinds of discrimination analysis covered here</a></li>
  <li><a href="#summary-of-symbols" id="toc-summary-of-symbols" class="nav-link" data-scroll-target="#summary-of-symbols"><span class="header-section-number">1.6</span> Summary of symbols</a></li>
  <li><a href="#a-word-before-getting-started" id="toc-a-word-before-getting-started" class="nav-link" data-scroll-target="#a-word-before-getting-started"><span class="header-section-number">1.7</span> A word before getting started</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and Motivating Examples</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div style="page-break-after: always;"></div>
<div class="cell">
<div class="cell-output-display">
<p><img src="intro_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To set the stage, consider the following:</p>
<section id="sec-ucb" class="level2 page-columns page-full" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="sec-ucb"><span class="header-section-number">1.1</span> UC Berkeley discrimination claims</h2>
<p><img src="SatherGate.jpg" class="img-fluid" style="width:35.0%"></p>
<p>UC Berkeley was accused of discriminating against female applicants for graduate school, and indeed the overall acceptance rate for women was lower than that for men. This seemed odd, given Berkeley’s liberal reputation.</p>
<div class="page-columns page-full"><p>However, upon breaking the data down  according to the program students were applying to, it was found that in every department, the female acceptance rate <em>within that department</em> was either higher than the male rate or of similar level. The problem: women were applying to more selective programs, causing their overall rate to below that of men.</p><div class="no-row-height column-margin column-container"><span class="">This data is included in R, as the built-in dataset <strong>UCBAdmissions</strong>.</span></div></div>
</section>
<section id="sec-census" class="level2 page-columns page-full" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="sec-census"><span class="header-section-number">1.2</span> US Census data</h2>
<p><img src="USCensus.png" class="img-fluid" style="width:40.0%"></p>
<div class="page-columns page-full"><p>The <strong>svcensus</strong> dataset is a subset of US census data from back in 2000, focusing on six engineering occupations.  The question at hand is whether there is a gender pay gap. Again, the overall pay for men is higher, by about 25%. But what if we break things down by occupation? Though it does turn out that some occupations pay more than others, and that men and women are not distributed evenly among the occupations, there still is a gender pay gap, of about 16%.</p><div class="no-row-height column-margin column-container"><span class="">Included here in the <strong>dsld</strong> package.</span></div></div>
</section>
<section id="commonality" class="level2 page-columns page-full" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="commonality"><span class="header-section-number">1.3</span> Commonality</h2>
<div class="page-columns page-full"><p>In both examples, we have an outcome variable Y of interest<span class="math inline">\(\textemdash\)</span>acceptance  rate and wage income<span class="math inline">\(\textemdash\)</span>and a sensitive variable S, which was gender in both examples. But in both cases, were are concerned that merely comparing mean Y for each gender was an oversimplication, due to a possible <em>confounder</em> C<span class="math inline">\(\textemdash\)</span>department in the first example, occupation in the second<span class="math inline">\(\textemdash\)</span> that is related to both variables. Failure to take confounders (there can be more than one, and usually are so) into account can lead to spurious “relations” between S and Y.</p><div class="no-row-height column-margin column-container"><span class="">As noted earlier, this book avoids technical definitions, keeping to the intuitive, including our notion here of a confounder. Actually, a fully precise definition is rather <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4276366/">problematic</a>.</span></div></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Confounder adjustment analysis
</div>
</div>
<div class="callout-body-container callout-body">
<p>So, in general, we wish to <em>estimate the impact</em> of a sensitive variable S on an outcome variable Y, but <em>accounting for confounders</em> C. Let’s call such analysis “confounder adjustment.”</p>
</div>
</div>
<p>The above discussion summarizes the goal of Part I of this book. Now contrast the above examples with a different kind, which will concern Part II:</p>
</section>
<section id="compas-recidivism-data" class="level2 page-columns page-full" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="compas-recidivism-data"><span class="header-section-number">1.4</span> COMPAS recidivism data</h2>
<p>COMPAS is a commercial machine learning software tool for aiding judges in sentencing defendants convicted of a crime. The tool’s main function is to predict recidivism by a defendant. But a 2016 <a href="https://www.propublica.org/article/machine-bias-risk-assessments-in-criminal-sentencing"><em>Pro Publica</em> investigation</a> found that the tool to be racially biased; African-American defendants tended to be given harsher ratings<span class="math inline">\(\textemdash\)</span>i.e.&nbsp;higher estimated probabilities of recidivism<span class="math inline">\(\textemdash\)</span>than similarly situated white defendants.</p>
<div class="page-columns page-full"><p>Northpointe, the firm that developed COMPAS, <a href="https://www.equivant.com/response-to-propublica-demonstrating-accuracy-equity-and-predictive-parity/">rejects the <em>Pro Publica</em> analysis</a>, and we are not supporting either side here.<br>
 But if the COMPAS tool were in fact biased, how could the analysis be fixed?</p><div class="no-row-height column-margin column-container"><span class="">Note that both <em>Pro Publica</em>’s analysis and that of Northpointe used methodology like that presented in this book.</span></div></div>
<p>A key point is that any remedy must not only avoid using race directly, but must also minimize the impact of variables O that are separate from race but still correlated with it, known as <em>proxies</em>. If, say, educational attainment is correlated with race, the inclusion of educational in our analysis will mean that race is still playing a role in our analysis after all.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Fair ML analysis
</div>
</div>
<div class="callout-body-container callout-body">
<p>Thus our goal is to <em>predict the outcome</em> variable Y, without using the sensitive variable S, while making only limited use of the proxy variables O.</p>
</div>
</div>
</section>
<section id="summary-the-two-kinds-of-discrimination-analysis-covered-here" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="summary-the-two-kinds-of-discrimination-analysis-covered-here"><span class="header-section-number">1.5</span> Summary: the two kinds of discrimination analysis covered here</h2>
<p>Note the difference between accounting for confounders on the one hand, and fair ML on the other. Here is a side-by-side comparison:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">aspect</th>
<th style="text-align: left;">confounder adjustment</th>
<th style="text-align: left;">fair ML</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">goal</td>
<td style="text-align: left;">estimate an effect</td>
<td style="text-align: left;">predict an outcome</td>
</tr>
<tr class="even">
<td style="text-align: left;">harm</td>
<td style="text-align: left;">comes from society</td>
<td style="text-align: left;">comes from an algorithm</td>
</tr>
<tr class="odd">
<td style="text-align: left;">side info</td>
<td style="text-align: left;">adjust for confounders</td>
<td style="text-align: left;">limit impact of proxies</td>
</tr>
</tbody>
</table>
<p>Part I, on confounder adjustment, focuses on discrimination examples but is applicable to confounder adjustment applications in general. Part II, on fair ML, is more specific to discrimination settings.</p>
</section>
<section id="summary-of-symbols" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="summary-of-symbols"><span class="header-section-number">1.6</span> Summary of symbols</h2>
<p>The symbol X will at first denote all the the variables other than Y and S. The general terminology is that Y is variously called the <em>outcome variable</em>, <em>target variable</em> or <em>dependent variable</em>; the X variables are known collectively as <em>covariates</em>, <em>features</em> or <em>independent variables</em>.</p>
<p>Among the variables in X, we will separate out some to play the role of C (Part I) or O (Part II), after which X will refer to all variables other than Y, S, C and O.</p>
<p>In terms of the above examples, here are the roles of the variables:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">example</th>
<th style="text-align: left;">Y</th>
<th style="text-align: left;">C</th>
<th style="text-align: left;">S</th>
<th style="text-align: left;">O</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">UCB admits</td>
<td style="text-align: left;">acceptance</td>
<td style="text-align: left;">department</td>
<td style="text-align: left;">gender</td>
<td style="text-align: left;">-</td>
</tr>
<tr class="even">
<td style="text-align: left;">Census</td>
<td style="text-align: left;">wage</td>
<td style="text-align: left;">e.g.&nbsp;occupation</td>
<td style="text-align: left;">gender</td>
<td style="text-align: left;">-</td>
</tr>
<tr class="odd">
<td style="text-align: left;">COMPAS</td>
<td style="text-align: left;">recidivate</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">race</td>
<td style="text-align: left;">e.g.&nbsp;education</td>
</tr>
</tbody>
</table>
</section>
<section id="a-word-before-getting-started" class="level2 page-columns page-full" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="a-word-before-getting-started"><span class="header-section-number">1.7</span> A word before getting started</h2>
<p>As noted, the book consists of two main topics:</p>
<ul>
<li><p>Part I, adjusting for confounders</p></li>
<li><p>Part II, fair ML</p></li>
</ul>
<p>In each case, we present explanations of the relevant concepts, so that this is a general tutorial on methodology for analysis of discrimination, and show the details of using our <strong>dsld</strong> package to make use of that methodology.</p>
<p>So, let’s get started. One key point first, though:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Notes on modeling, the role of the software, etc.
</div>
</div>
<div class="callout-body-container callout-body">
<p>This book makes use of the <strong>dsld</strong> software, but is definitely not a user manual for that package. Instead, it is a guide to the statistical principles, with the software playing a supporting role.</p>
<p>Any statistical model is approximate.  And virtually any relation of interest in practice is nonzero. Modern statistical thinking places reduced emphasis on significance tests and p-values, and asks instead whether A has an effect on B that is substantial enough to be of interest.</p>
<p>A related point is that, unlike some readers may have experienced in some statistics courses, real-world statistical analysis is not conducted in a formulaic, “Step 1, Step 2,…” manner. Instead, decisions on say, which model to use, must be made by you, the analyst, based on your overall assessment of the available information. The software cannot make your decisions for you.</p>
</div>
</div>


<div class="no-row-height column-margin column-container"><span class="callout-margin-content">The pioneering statistician George Box famously said, “All models are wrong, but some are useful.”</span></div></section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Overview</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./PartI.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Part I: Adjustment for Confounders</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>